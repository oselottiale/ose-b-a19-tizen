<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://t4.oseale.com/favicon.png?v=2" type="image/png">
  <title>Inner.html | t4.oseale.com</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background-color: #000;
    }
    iframe {
      border: none;
      width: 100vw;
      height: 100vh;
      display: block;
    }
    #slideshowFrame {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
    }
    #debugMenu {
      position: fixed;
      bottom: 20px;
      left: 20px;
      padding: 10px;
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      font-family: monospace;
      z-index: 10000;
      display: none;
      white-space: pre;
    }
    .debug-visible #debugMenu {
      display: block;
    }
  </style>
</head>
<body>
  <iframe id="slideshowFrame" src="" allowfullscreen></iframe>

  <div id="debugMenu"></div>

  <script>
    var CONFIG_URL = "https://script.google.com/macros/s/AKfycbxVt8q-GsdsmC4linHgu7X3NlSTzKZUmNSrqJ70GkQ4KZx0dPpC1eMBYrfanYsglRowLQ/exec";
    var DEFAULT_ID = "19q6v5NqyDLkIB89l-IFuDSy2njVl7bPuESDeXtLZCCQ";
    var DEFAULT_DELAY = 7000;
    var lastConfigTime = "";
    var currentId = "";
    var currentDelay = "";
    var nextRefreshTime = "";

    function loadConfig() {
      var xhr = new XMLHttpRequest();
      xhr.open("GET", CONFIG_URL, true);

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          var cfg;
          if (xhr.status === 200) {
            try { cfg = JSON.parse(xhr.responseText); }
            catch (e) { cfg = {}; }
          } else {
            cfg = {};
          }
          applyConfig(cfg);
        }
      };

      xhr.send();
    }

    function applyConfig(cfg) {
      var id = cfg.slideshowId || DEFAULT_ID;
      var delay = cfg.slideDelay || DEFAULT_DELAY;
      var refreshFlag = cfg.refreshAll;

      currentId = id;
      currentDelay = delay;
      lastConfigTime = new Date().toLocaleTimeString();

      var url = "https://docs.google.com/presentation/d/" +
        id +
        "/embed?start=true&loop=true&delayms=" +
        delay +
        "&rm=minimal";

      document.getElementById("slideshowFrame").src = url;

      if (refreshFlag === 1) {
        setTimeout(function () {
          location.reload(true);
        }, 2000);
      }
    }

    function scheduleNextMinute() {
      var now = new Date();
      var ms = (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
      var next = new Date(now.getTime() + ms);
      nextRefreshTime = next.toLocaleTimeString();

      setTimeout(function () {
        loadConfig();
        scheduleNextMinute();
      }, ms);
    }

    function updateDebug() {
      var box = document.getElementById("debugMenu");
      var now = new Date().toLocaleTimeString();
      box.textContent =
        "Time: " + now +
        "\nNext refresh: " + nextRefreshTime +
        "\nLast config: " + lastConfigTime +
        "\nID: " + currentId +
        "\nDelay: " + currentDelay;
    }

    setInterval(updateDebug, 500);

    document.addEventListener("keydown", function (e) {
      if (e.key === "F3") {
        document.body.classList.toggle("debug-visible");
      }
    });

    loadConfig();
    scheduleNextMinute(); 
  </script>
</body>
</html>
