<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://t4.oseale.com/favicon.png?v=2" type="image/png">
  <title>Inner2.html | t4.oseale.com</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background-color: #000; 
    }

    iframe {
      border: none;
      width: 100vw;
      height: 100vh;
      display: block;
    }
    #debugMenu {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 20px;
      padding: 10px;
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      font-family: monospace;
      z-index: 10000;
    }
    
    .debug-visible #debugMenu {
      display: block;
    }
  </style>
</head>
<body>
  <iframe
  id="slideshowFrame"
  src="https://docs.google.com/presentation/d/e/2PACX-1vQwfM3Ns0fWrfCjer7gYcTTJ_d96j7WlZ0RPTY_t9I_mtR1E-05P3PVy9wnYkuPmPmXWdYOjl8LGlAC/embed?start=true&loop=true&delayms=5000&rm=minimal"
  style="width: 100vw; height: 100vh; border: none; display: block;"
  allowfullscreen
></iframe>
  <script type="module" src="./firebase.js"></script>
  
  <script type="module">
    import { remoteConfig, fetchAndActivate, getValue } from './firebase.js';

    
    let lastVersion = remoteConfig.defaultConfig.refresh_version;

    async function checkForUpdate() {
      try {
        const fetchedRemotely = await fetchAndActivate(remoteConfig);
        const current = getValue(remoteConfig, 'refresh_version').asString();
    
        // Show fetch source
        const fetchEl = document.getElementById("fetchSource");
        const sourceText = fetchedRemotely ? "Fresh from server" : "Served from cache";
        fetchEl.textContent = sourceText;
        fetchEl.style.color = fetchedRemotely ? "#0f0" : "#888";
    
        if (current !== lastVersion) {
          lastVersion = current;
          location.reload();
        }
    
        console.log("Current version:", current);
        console.log("Last version:", lastVersion);
        console.log("Fetched from:", sourceText);
      } catch (e) {
        console.error('Remote Config error:', e);
      }
    }
    
    let interval = 60_000; // 60 seconds
    let nextUpdateTime = Date.now() + interval;
    
    function updateCountdown() {
      const now = Date.now();
      const msRemaining = nextUpdateTime - now;
      const secondsRemaining = Math.max(0, Math.floor(msRemaining / 1000));
      document.getElementById("timeUntilNext").textContent = secondsRemaining + "s";
    }
    
    setInterval(() => {
      checkForUpdate();            // Your function
      nextUpdateTime = Date.now() + interval;
    }, interval);
    
    setInterval(updateCountdown, 1000); // Update debug menu countdown every second

    function scheduleMidnightReload() {
      const now = new Date();
      const midnight = new Date();
    
      midnight.setHours(24, 0, 0, 0); // Set to next 0:00
    
      const timeUntilMidnight = midnight.getTime() - now.getTime();
    
      setTimeout(() => {
        location.reload();
      }, timeUntilMidnight);
    }
    
    scheduleMidnightReload();

    function displayTimeUntilMidnight() {
      const now = new Date();
      const midnight = new Date();
    
      midnight.setHours(24, 0, 0, 0); // Set to next 0:00
    
      const msLeft = midnight.getTime() - now.getTime();
    
      const hours = Math.floor(msLeft / 1000 / 60 / 60);
      const minutes = Math.floor((msLeft / 1000 / 60) % 60);
      const seconds = Math.floor((msLeft / 1000) % 60);
    
      const formatted = `${hours}h ${minutes}m ${seconds}s until midnight`;
      document.getElementById("midnightTime").textContent = formatted;
    }

// Call it once on load
    displayTimeUntilMidnight();
  </script>
  <div id="debugMenu">
  <p>Next update in: <span id="timeUntilNext">60s</span></p>
  <p>Fetch source: <span id="fetchSource">â€”</span></p>
  <p id="midnightTime"></p>
  </div>
<script>
  function toggleDebugMenu() {
    document.body.classList.toggle("debug-visible");
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "F3") {
      e.preventDefault(); // optional
      toggleDebugMenu();
    }
  });
</script>
</body>
</html>
